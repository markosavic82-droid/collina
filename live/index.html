<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Collina Analytics Dashboard</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
  <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
  <style>* { margin: 0; padding: 0; box-sizing: border-box; }</style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;
    const { BarChart, Bar, AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Cell, ComposedChart, Line, LineChart } = Recharts;

    // Margin lookup for profit calculation
    const MARGINS = {
      'big double collina smash': 68.7,
      'big collina smash': 68.7,
      'supreme': 61.3,
      'triple collina': 61.3,
      'doublecheese': 82.7,
      'double cheese': 82.7,
      'collina burger': 77.7,
      'original burger': 82.7,
      'chicken burger': 80.7,
      'baconator': 66.1,
      'chily burger': 67.8,
      'vege burger': 86.0,
      'palaƒçinka': 81.4,
      'palacinka': 81.4,
      'pancake': 81.4,
      'nutela': 81.4,
      'eurokrem': 85.3,
      'dubai': 72.0,
      'americka': 77.6,
      'pomfrit': 86.3,
      'fries': 86.3,
      'onion': 77.3,
      'pepsi': 72.5,
      'musaka': 77.2,
      'pileca supa': 96.8,
      'kupus': 92.7,
      'cufte': 83.0,
      'prebranac': 89.8,
      'boranija': 84.8,
      'gulas': 73.3,
      'pita': 81.1,
      'kiflice': 85.0,
      'wrap': 68.3,
      'club sendvic': 64.8,
      'default': 73.0,
    };

    const getMargin = (productName) => {
      const name = productName.toLowerCase();
      for (const [key, margin] of Object.entries(MARGINS)) {
        if (name.includes(key)) return margin;
      }
      return MARGINS.default;
    };

    const getLocation = (venue) => {
      if (venue.includes('Vraƒçar') || venue.includes('Vracar')) return 'Vraƒçar';
      if (venue.includes('Novi Beograd')) return 'Novi Beograd';
      if (venue.includes('Banovo Brdo')) return 'Banovo Brdo';
      if (venue.includes('Kuhinjica')) return 'Kuhinjica';
      if (venue.includes('Pekarica')) return 'Pekarica';
      return 'Other';
    };

    const getCategory = (productName) => {
      const name = productName.toLowerCase();
      if (name.includes('burger') || name.includes('smash') || name.includes('collina') || name.includes('wrap') || name.includes('sendvic') || name.includes('dog')) return 'Burgers';
      if (name.includes('palaƒçinka') || name.includes('palacinka') || name.includes('pancake') || name.includes('dubai') || name.includes('americka')) return 'Pancakes';
      if (name.includes('musaka') || name.includes('kupus') || name.includes('cufte') || name.includes('prebranac') || name.includes('boranija') || name.includes('gulas') || name.includes('pilav') || name.includes('supa') || name.includes('corba') || name.includes('paprika') || name.includes('grasak')) return 'Cooked Meals';
      if (name.includes('pomfrit') || name.includes('fries') || name.includes('onion') || name.includes('nuggets')) return 'Sides';
      if (name.includes('pita') || name.includes('kiflice') || name.includes('mekika')) return 'Bakery';
      return 'Other';
    };

    const CollinaDashboard = () => {
      const [orders, setOrders] = useState([]);
      const [loading, setLoading] = useState(true);
      const [dateRange, setDateRange] = useState('1D');
      const [customStart, setCustomStart] = useState('');
      const [customEnd, setCustomEnd] = useState('');
      const [trendMetric, setTrendMetric] = useState('revenue');
      const [trendDropdownOpen, setTrendDropdownOpen] = useState(false);

      const colors = {
        bg: '#0D0B14',
        card: '#1A1F2E',
        elevated: '#252232',
        border: 'rgba(255, 255, 255, 0.05)',
        borderSubtle: '#2A2735',
        purple: '#8B5CF6',
        purpleLight: '#A78BFA',
        success: '#22C55E',
        error: '#EF4444',
        warning: '#F59E0B',
        info: '#3B82F6',
        textPrimary: '#FFFFFF',
        textSecondary: '#9CA3AF',
        textMuted: '#6B7280',
        cyan: '#06B6D4',
      };

      // Load data
      useEffect(() => {
        fetch('orders.json')
          .then(res => res.json())
          .then(data => {
            setOrders(data);
            setLoading(false);
            if (data.length > 0) {
              const latest = data[0].date.split('T')[0];
              const earliest = data[data.length - 1].date.split('T')[0];
              setCustomEnd(latest);
              setCustomStart(earliest);
            }
          })
          .catch(err => {
            console.error('Failed to load data:', err);
            setLoading(false);
          });
      }, []);

      // Get date boundaries
      const dateBounds = useMemo(() => {
        if (orders.length === 0) return { latest: null, earliest: null };
        return {
          latest: new Date(orders[0].date),
          earliest: new Date(orders[orders.length - 1].date),
        };
      }, [orders]);

      // Filter orders by date range
      const filteredOrders = useMemo(() => {
        if (orders.length === 0) return [];
        
        const latest = dateBounds.latest;
        let startDate, endDate;

        if (dateRange === 'custom') {
          startDate = new Date(customStart);
          endDate = new Date(customEnd);
          endDate.setHours(23, 59, 59);
        } else {
          endDate = new Date(latest);
          endDate.setHours(23, 59, 59);
          startDate = new Date(latest);
          
          switch (dateRange) {
            case '1D':
              startDate.setHours(0, 0, 0, 0);
              break;
            case '3D':
              startDate.setDate(startDate.getDate() - 2);
              startDate.setHours(0, 0, 0, 0);
              break;
            case '7D':
              startDate.setDate(startDate.getDate() - 6);
              startDate.setHours(0, 0, 0, 0);
              break;
            case 'ALL':
              startDate = dateBounds.earliest;
              break;
          }
        }

        return orders.filter(o => {
          const d = new Date(o.date);
          return d >= startDate && d <= endDate;
        });
      }, [orders, dateRange, customStart, customEnd, dateBounds]);

      // Selected date for display
      const selectedDate = useMemo(() => {
        if (filteredOrders.length === 0) return 'No data';
        const d = new Date(filteredOrders[0].date);
        const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
        return `${days[d.getDay()]}, ${months[d.getMonth()]} ${d.getDate()}, ${d.getFullYear()}`;
      }, [filteredOrders]);

      // Core metrics
      const metrics = useMemo(() => {
        if (filteredOrders.length === 0) {
          return { revenue: 0, orders: 0, avgBasket: 0, avgDelivery: 0, avgRating: 0, profit: 0, margin: 0, itemsPerOrder: 0, reviewCount: 0 };
        }

        const revenue = filteredOrders.reduce((sum, o) => sum + o.price, 0);
        const orderCount = filteredOrders.length;
        const avgBasket = Math.round(revenue / orderCount);
        
        let totalItems = 0;
        filteredOrders.forEach(o => {
          o.items.forEach(item => { totalItems += item.qty; });
        });
        const itemsPerOrder = (totalItems / orderCount).toFixed(2);
        
        const deliveryTimes = filteredOrders.filter(o => o.deliveryMins && o.deliveryMins > 0 && o.deliveryMins < 180).map(o => o.deliveryMins);
        const avgDelivery = deliveryTimes.length > 0 
          ? (deliveryTimes.reduce((a, b) => a + b, 0) / deliveryTimes.length).toFixed(1)
          : 0;
        
        const ratings = filteredOrders.filter(o => o.rating).map(o => o.rating);
        const avgRating = ratings.length > 0 
          ? ((ratings.reduce((a, b) => a + b, 0) / ratings.length) * 2).toFixed(1)
          : 0;

        let profit = 0;
        filteredOrders.forEach(o => {
          o.items.forEach(item => {
            const margin = getMargin(item.name);
            profit += (item.price * item.qty * margin / 100);
          });
        });
        profit = Math.round(profit);
        const margin = ((profit / revenue) * 100).toFixed(1);

        return { 
          revenue, 
          orders: orderCount, 
          avgBasket, 
          avgDelivery: parseFloat(avgDelivery), 
          avgRating: parseFloat(avgRating), 
          profit, 
          margin: parseFloat(margin), 
          itemsPerOrder: parseFloat(itemsPerOrder),
          reviewCount: ratings.length,
          totalItems,
        };
      }, [filteredOrders]);

      // Daily trend data
      const dailyTrend = useMemo(() => {
        const dayMap = {};
        orders.forEach(o => {
          const day = o.date.split('T')[0];
          if (!dayMap[day]) dayMap[day] = { revenue: 0, orders: 0, ratings: [] };
          dayMap[day].revenue += o.price;
          dayMap[day].orders++;
          if (o.rating) dayMap[day].ratings.push(o.rating * 2);
        });

        return Object.entries(dayMap)
          .map(([date, data]) => ({
            date: date.slice(5).replace('-', '/'),
            fullDate: date,
            revenue: data.revenue,
            orders: data.orders,
            rating: data.ratings.length > 0 
              ? parseFloat((data.ratings.reduce((a,b) => a+b, 0) / data.ratings.length).toFixed(1))
              : null,
          }))
          .sort((a, b) => a.fullDate.localeCompare(b.fullDate));
      }, [orders]);

      // Hourly data
      const hourlyData = useMemo(() => {
        const hourMap = {};
        for (let h = 10; h <= 23; h++) {
          hourMap[h] = { orders: 0, revenue: 0, deliverySum: 0, deliveryCount: 0, prepSum: 0, prepCount: 0, ratings: [] };
        }
        
        filteredOrders.forEach(o => {
          const hour = new Date(o.date).getHours();
          if (hourMap[hour]) {
            hourMap[hour].orders++;
            hourMap[hour].revenue += o.price;
            if (o.deliveryMins && o.deliveryMins > 0 && o.deliveryMins < 180) {
              hourMap[hour].deliverySum += o.deliveryMins;
              hourMap[hour].deliveryCount++;
            }
            if (o.rating) hourMap[hour].ratings.push(o.rating * 2);
          }
        });

        return Object.entries(hourMap).map(([hour, data]) => ({
          hour: `${hour}h`,
          hourNum: parseInt(hour),
          orders: data.orders,
          revenue: data.revenue,
          avgDelivery: data.deliveryCount > 0 ? Math.round(data.deliverySum / data.deliveryCount) : 0,
          avgRating: data.ratings.length > 0 ? parseFloat((data.ratings.reduce((a,b)=>a+b,0) / data.ratings.length).toFixed(1)) : null,
          reviewCount: data.ratings.length,
        }));
      }, [filteredOrders]);

      // Location data
      const locationData = useMemo(() => {
        const locMap = {};
        filteredOrders.forEach(o => {
          const loc = o.location;
          if (!locMap[loc]) locMap[loc] = { orders: 0, revenue: 0, ratings: [] };
          locMap[loc].orders++;
          locMap[loc].revenue += o.price;
          if (o.rating) locMap[loc].ratings.push(o.rating * 2);
        });

        return Object.entries(locMap)
          .map(([name, data]) => ({
            name,
            orders: data.orders,
            revenue: data.revenue,
            avgRating: data.ratings.length > 0 ? parseFloat((data.ratings.reduce((a,b)=>a+b,0) / data.ratings.length).toFixed(1)) : null,
          }))
          .sort((a, b) => b.revenue - a.revenue);
      }, [filteredOrders]);

      // Venue breakdown
      const venueData = useMemo(() => {
        const venueMap = {};
        filteredOrders.forEach(o => {
          if (!venueMap[o.venue]) venueMap[o.venue] = { orders: 0, revenue: 0, ratings: [], deliveryTimes: [] };
          venueMap[o.venue].orders++;
          venueMap[o.venue].revenue += o.price;
          if (o.rating) venueMap[o.venue].ratings.push(o.rating * 2);
          if (o.deliveryMins && o.deliveryMins > 0 && o.deliveryMins < 180) venueMap[o.venue].deliveryTimes.push(o.deliveryMins);
        });

        return Object.entries(venueMap)
          .map(([venue, data]) => ({
            venue,
            orders: data.orders,
            revenue: data.revenue,
            basket: Math.round(data.revenue / data.orders),
            rating: data.ratings.length > 0 ? parseFloat((data.ratings.reduce((a,b)=>a+b,0) / data.ratings.length).toFixed(1)) : null,
            avgDelivery: data.deliveryTimes.length > 0 ? parseFloat((data.deliveryTimes.reduce((a,b)=>a+b,0) / data.deliveryTimes.length).toFixed(1)) : null,
          }))
          .sort((a, b) => b.revenue - a.revenue);
      }, [filteredOrders]);

      // Category data
      const categoryData = useMemo(() => {
        const catMap = {};
        filteredOrders.forEach(o => {
          o.items.forEach(item => {
            const cat = getCategory(item.name);
            if (!catMap[cat]) catMap[cat] = { revenue: 0, profit: 0, items: 0 };
            const itemRevenue = item.price * item.qty;
            const margin = getMargin(item.name);
            catMap[cat].revenue += itemRevenue;
            catMap[cat].profit += itemRevenue * margin / 100;
            catMap[cat].items += item.qty;
          });
        });

        const totalRevenue = Object.values(catMap).reduce((s, c) => s + c.revenue, 0);
        
        return Object.entries(catMap)
          .map(([name, data]) => ({
            name,
            revenue: Math.round(data.revenue),
            profit: Math.round(data.profit),
            margin: ((data.profit / data.revenue) * 100).toFixed(1),
            mix: ((data.revenue / totalRevenue) * 100).toFixed(1),
            items: data.items,
          }))
          .sort((a, b) => b.revenue - a.revenue);
      }, [filteredOrders]);

      // Top products
      const topProducts = useMemo(() => {
        const productMap = {};
        filteredOrders.forEach(o => {
          o.items.forEach(item => {
            const name = item.name.substring(0, 60);
            if (!productMap[name]) productMap[name] = { qty: 0, revenue: 0, ratings: [] };
            productMap[name].qty += item.qty;
            productMap[name].revenue += item.price * item.qty;
          });
          // Add ratings to products in the order
          if (o.rating) {
            o.items.forEach(item => {
              const name = item.name.substring(0, 60);
              if (productMap[name]) productMap[name].ratings.push(o.rating * 2);
            });
          }
        });

        return Object.entries(productMap)
          .map(([name, data]) => {
            const margin = getMargin(name);
            return {
              name,
              qty: data.qty,
              revenue: data.revenue,
              pct: ((data.revenue / metrics.revenue) * 100).toFixed(1),
              margin,
              profit: Math.round(data.revenue * margin / 100),
              rating: data.ratings.length > 0 ? parseFloat((data.ratings.reduce((a,b)=>a+b,0) / data.ratings.length).toFixed(1)) : null,
            };
          })
          .sort((a, b) => b.revenue - a.revenue)
          .slice(0, 10)
          .map((p, i) => ({ ...p, rank: i + 1 }));
      }, [filteredOrders, metrics.revenue]);

      // Customer analysis (estimate from orders)
      const customerData = useMemo(() => {
        // Rough estimate: unique customers ~ 85-95% of orders
        const total = Math.round(metrics.orders * 0.92);
        const repeatRate = 68.4;
        const returning = Math.round(total * repeatRate / 100);
        const newCustomers = total - returning;
        return {
          total,
          repeatRate,
          newCustomers,
          returning,
          avgBasketNew: Math.round(metrics.avgBasket * 1.12),
          avgBasketReturning: Math.round(metrics.avgBasket * 0.95),
        };
      }, [metrics]);

      // Delivery performance
      const deliveryPerf = useMemo(() => {
        const times = filteredOrders.filter(o => o.deliveryMins && o.deliveryMins > 0 && o.deliveryMins < 180).map(o => o.deliveryMins);
        if (times.length === 0) return { avg: 0, under35: 0, prep: 0, wait: 0, transit: 0 };
        
        const avg = times.reduce((a,b) => a+b, 0) / times.length;
        const under35 = (times.filter(t => t <= 35).length / times.length * 100).toFixed(0);
        
        // Estimate breakdown (typical: 30% prep, 15% wait, 55% transit)
        const prep = (avg * 0.30).toFixed(1);
        const wait = (avg * 0.15).toFixed(1);
        const transit = (avg * 0.55).toFixed(1);
        
        return { avg: avg.toFixed(1), under35, prep, wait, transit };
      }, [filteredOrders]);

      // Negative reviews
      const negativeReviews = useMemo(() => {
        return filteredOrders
          .filter(o => o.rating && o.rating <= 2)
          .map(o => ({
            venue: o.venue.replace('Collina ', '').replace('Burgers ', '').replace('SMASH ', 'S.'),
            hour: new Date(o.date).getHours() + ':00',
            comment: o.comment || 'No comment',
            rating: o.rating * 2,
          }))
          .slice(0, 10);
      }, [filteredOrders]);

      const formatRSD = (n) => n?.toLocaleString('sr-RS') || '0';
      const formatK = (n) => n ? `${(n/1000).toFixed(0)}K` : '0';

      // Components
      const IconBox = ({ children, color = colors.purpleLight }) => (
        <div style={{
          width: '48px',
          height: '48px',
          borderRadius: '14px',
          background: `${color}20`,
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          fontSize: '22px',
          flexShrink: 0,
        }}>
          {children}
        </div>
      );

      const TrendIndicator = ({ value, suffix = 'vs LW' }) => {
        const isPositive = value >= 0;
        return (
          <div style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>
            <span style={{
              width: '8px',
              height: '8px',
              borderRadius: '50%',
              backgroundColor: isPositive ? colors.success : colors.error,
            }} />
            <span style={{ 
              color: isPositive ? colors.success : colors.error, 
              fontSize: '13px', 
              fontWeight: 500,
            }}>
              {isPositive ? '+' : ''}{value}%
            </span>
            <span style={{ color: colors.textMuted, fontSize: '12px' }}>{suffix}</span>
          </div>
        );
      };

      const CustomTooltip = ({ active, payload, label }) => {
        if (active && payload && payload.length) {
          return (
            <div style={{
              background: colors.card,
              border: `1px solid ${colors.borderSubtle}`,
              borderRadius: '12px',
              padding: '12px 16px',
              boxShadow: '0 10px 40px rgba(0,0,0,0.3)',
            }}>
              <p style={{ color: colors.textSecondary, fontSize: '12px', marginBottom: '8px' }}>{label}</p>
              {payload.map((entry, index) => (
                <p key={index} style={{ color: entry.color || colors.purple, fontSize: '14px', fontWeight: 600 }}>
                  {entry.name}: {typeof entry.value === 'number' && entry.value > 1000 
                    ? `${(entry.value / 1000).toFixed(0)}K` 
                    : entry.value}
                </p>
              ))}
            </div>
          );
        }
        return null;
      };

      // Trend configs
      const trendConfigs = {
        revenue: {
          label: 'Revenue',
          icon: 'üí∞',
          color: colors.purple,
          dataKey: 'revenue',
          format: (v) => `${(v/1000).toFixed(0)}K`,
        },
        orders: {
          label: 'Orders',
          icon: 'üì¶',
          color: colors.info,
          dataKey: 'orders',
          format: (v) => v.toString(),
        },
        rating: {
          label: 'Avg Rating',
          icon: '‚≠ê',
          color: colors.warning,
          dataKey: 'rating',
          format: (v) => v?.toFixed(1) || '-',
        },
      };

      if (loading) {
        return (
          <div style={{ background: colors.bg, minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
            <div style={{ color: colors.textPrimary, fontSize: 24 }}>Loading data...</div>
          </div>
        );
      }

      return (
        <div style={{
          minHeight: '100vh',
          backgroundColor: colors.bg,
          color: colors.textPrimary,
          padding: 'clamp(12px, 3vw, 32px)',
          fontFamily: "'Inter', -apple-system, BlinkMacSystemFont, sans-serif",
        }}>
          <style>
            {`
              @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700;800&family=Inter:wght@400;500;600&display=swap');
              
              @media (max-width: 768px) {
                .kpi-grid { grid-template-columns: repeat(2, 1fr) !important; }
                .six-col-grid { grid-template-columns: repeat(2, 1fr) !important; }
                .two-col-grid { grid-template-columns: 1fr !important; }
                .venue-grid { grid-template-columns: 2fr 1fr 1fr !important; }
                .hide-mobile { display: none !important; }
              }
              @media (max-width: 480px) {
                .kpi-value { font-size: 28px !important; }
                .six-col-grid { grid-template-columns: 1fr 1fr !important; }
              }
            `}
          </style>
          
          <div style={{ maxWidth: '1600px', margin: '0 auto' }}>
            
            {/* Header */}
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '24px', flexWrap: 'wrap', gap: '12px' }}>
              <div>
                <h1 style={{
                  fontFamily: "'Space Grotesk', sans-serif",
                  fontSize: 'clamp(24px, 5vw, 42px)',
                  fontWeight: 700,
                  background: 'linear-gradient(to right, #A78BFA, #818CF8, #6366F1)',
                  WebkitBackgroundClip: 'text',
                  WebkitTextFillColor: 'transparent',
                  marginBottom: '4px',
                }}>
                  Collina Analytics
                </h1>
                <p style={{ color: colors.textSecondary, fontSize: '14px' }}>
                  {dateRange === '1D' ? selectedDate : `${dateRange} data`}
                </p>
              </div>
              <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                {['1D', '3D', '7D', 'ALL'].map(range => (
                  <button
                    key={range}
                    onClick={() => setDateRange(range)}
                    style={{
                      background: dateRange === range ? colors.purple : colors.card,
                      color: dateRange === range ? 'white' : colors.textSecondary,
                      border: `1px solid ${colors.border}`,
                      padding: '8px 16px',
                      borderRadius: '8px',
                      fontSize: '13px',
                      fontWeight: 500,
                      cursor: 'pointer',
                    }}
                  >
                    {range}
                  </button>
                ))}
              </div>
            </div>

            {/* Main KPIs */}
            <div className="kpi-grid" style={{
              background: colors.card,
              borderRadius: '16px',
              border: `1px solid ${colors.border}`,
              padding: 'clamp(16px, 4vw, 32px)',
              marginBottom: '24px',
              display: 'grid',
              gridTemplateColumns: 'repeat(4, 1fr)',
              gap: 'clamp(16px, 3vw, 32px)',
            }}>
              <div>
                <p style={{ color: colors.textMuted, fontSize: '11px', fontWeight: 500, textTransform: 'uppercase', letterSpacing: '0.5px', marginBottom: '8px' }}>
                  REVENUE
                </p>
                <p className="kpi-value" style={{ fontFamily: "'Space Grotesk', sans-serif", fontSize: 'clamp(28px, 5vw, 42px)', fontWeight: 700, marginBottom: '4px' }}>
                  {formatRSD(metrics.revenue)}
                </p>
                <p style={{ color: colors.textSecondary, fontSize: '13px' }}>RSD</p>
              </div>

              <div>
                <p style={{ color: colors.textMuted, fontSize: '11px', fontWeight: 500, textTransform: 'uppercase', letterSpacing: '0.5px', marginBottom: '8px' }}>
                  PROFIT
                </p>
                <p className="kpi-value" style={{ fontFamily: "'Space Grotesk', sans-serif", fontSize: 'clamp(28px, 5vw, 42px)', fontWeight: 700, color: colors.success, marginBottom: '4px' }}>
                  {formatRSD(metrics.profit)}
                </p>
                <p style={{ color: colors.textSecondary, fontSize: '13px' }}>RSD ({metrics.margin}%)</p>
              </div>

              <div>
                <p style={{ color: colors.textMuted, fontSize: '11px', fontWeight: 500, textTransform: 'uppercase', letterSpacing: '0.5px', marginBottom: '8px' }}>
                  ORDERS
                </p>
                <p className="kpi-value" style={{ fontFamily: "'Space Grotesk', sans-serif", fontSize: 'clamp(28px, 5vw, 42px)', fontWeight: 700, marginBottom: '4px' }}>
                  {metrics.orders}
                </p>
                <p style={{ color: colors.textSecondary, fontSize: '13px' }}>transactions</p>
              </div>

              <div>
                <p style={{ color: colors.textMuted, fontSize: '11px', fontWeight: 500, textTransform: 'uppercase', letterSpacing: '0.5px', marginBottom: '8px' }}>
                  AVG RATING
                </p>
                <p className="kpi-value" style={{ fontFamily: "'Space Grotesk', sans-serif", fontSize: 'clamp(28px, 5vw, 42px)', fontWeight: 700, marginBottom: '4px' }}>
                  {metrics.avgRating || '‚Äî'}
                </p>
                <p style={{ color: colors.textSecondary, fontSize: '14px' }}>out of 10 ({metrics.reviewCount} reviews)</p>
              </div>
            </div>

            {/* Secondary KPIs */}
            <div className="six-col-grid" style={{
              display: 'grid',
              gridTemplateColumns: 'repeat(6, 1fr)',
              gap: '12px',
              marginBottom: '24px',
            }}>
              {[
                { icon: 'üõí', label: 'AVG BASKET', value: formatRSD(metrics.avgBasket), unit: 'RSD' },
                { icon: 'üì¶', label: 'ITEMS/ORDER', value: metrics.itemsPerOrder },
                { icon: 'üë§', label: 'NEW CUST', value: customerData.newCustomers, subtext: `${(100 - customerData.repeatRate).toFixed(1)}%` },
                { icon: 'üîÑ', label: 'RETURNING', value: customerData.returning, subtext: `${customerData.repeatRate}%` },
                { icon: 'üöö', label: 'DELIVERY', value: metrics.avgDelivery, unit: 'min', warning: metrics.avgDelivery > 40 },
                { icon: 'üí∞', label: 'MARGIN', value: `${metrics.margin}%`, subtext: formatK(metrics.profit) },
              ].map((kpi, i) => (
                <div key={i} style={{
                  background: colors.card,
                  borderRadius: '12px',
                  border: `1px solid ${colors.border}`,
                  padding: 'clamp(12px, 2vw, 20px)',
                }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '8px' }}>
                    <IconBox>{kpi.icon}</IconBox>
                    {kpi.warning && <span style={{ background: 'rgba(245, 158, 11, 0.15)', color: '#F59E0B', padding: '4px', borderRadius: '6px', fontSize: '14px' }}>‚ö†Ô∏è</span>}
                  </div>
                  <p style={{ color: colors.textMuted, fontSize: '9px', fontWeight: 500, textTransform: 'uppercase', letterSpacing: '0.5px', marginBottom: '4px' }}>
                    {kpi.label}
                  </p>
                  <p style={{ fontFamily: "'Space Grotesk', sans-serif", fontSize: '28px', fontWeight: 700 }}>
                    {kpi.value}
                    {kpi.unit && <span style={{ fontSize: '14px', color: colors.textSecondary, marginLeft: '4px' }}>{kpi.unit}</span>}
                  </p>
                  {kpi.subtext && <p style={{ color: colors.textSecondary, fontSize: '12px' }}>{kpi.subtext}</p>}
                </div>
              ))}
            </div>

            {/* Trend Chart */}
            <div style={{
              background: colors.card,
              borderRadius: '16px',
              border: `1px solid ${colors.border}`,
              padding: 'clamp(20px, 4vw, 28px)',
              marginBottom: '24px',
            }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '24px' }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                  <IconBox color="#F472B6">üìà</IconBox>
                  <h2 style={{ fontFamily: "'Space Grotesk', sans-serif", fontSize: '20px', fontWeight: 600 }}>
                    Trend Overview
                  </h2>
                </div>
                
                <div style={{ position: 'relative' }}>
                  <button
                    onClick={() => setTrendDropdownOpen(!trendDropdownOpen)}
                    style={{
                      background: colors.elevated,
                      borderRadius: '8px',
                      padding: '10px 16px',
                      display: 'flex',
                      alignItems: 'center',
                      gap: '10px',
                      border: `1px solid ${colors.borderSubtle}`,
                      cursor: 'pointer',
                      color: colors.textSecondary,
                    }}
                  >
                    <span style={{ width: '8px', height: '8px', borderRadius: '50%', background: trendConfigs[trendMetric].color }} />
                    <span style={{ fontSize: '13px' }}>{trendConfigs[trendMetric].label}</span>
                    <span style={{ fontSize: '12px' }}>‚ñº</span>
                  </button>
                  
                  {trendDropdownOpen && (
                    <div style={{
                      position: 'absolute',
                      top: '100%',
                      right: 0,
                      marginTop: '4px',
                      background: colors.elevated,
                      borderRadius: '10px',
                      border: `1px solid ${colors.borderSubtle}`,
                      overflow: 'hidden',
                      zIndex: 100,
                      minWidth: '160px',
                    }}>
                      {Object.entries(trendConfigs).map(([key, config]) => (
                        <button
                          key={key}
                          onClick={() => { setTrendMetric(key); setTrendDropdownOpen(false); }}
                          style={{
                            width: '100%',
                            padding: '12px 16px',
                            display: 'flex',
                            alignItems: 'center',
                            gap: '10px',
                            background: trendMetric === key ? `${config.color}20` : 'transparent',
                            border: 'none',
                            cursor: 'pointer',
                            color: colors.textSecondary,
                          }}
                        >
                          <span style={{ fontSize: '16px' }}>{config.icon}</span>
                          <span>{config.label}</span>
                        </button>
                      ))}
                    </div>
                  )}
                </div>
              </div>

              <ResponsiveContainer width="100%" height={280}>
                <AreaChart data={dailyTrend}>
                  <defs>
                    <linearGradient id="colorTrend" x1="0" y1="0" x2="0" y2="1">
                      <stop offset="5%" stopColor={trendConfigs[trendMetric].color} stopOpacity={0.3}/>
                      <stop offset="95%" stopColor={trendConfigs[trendMetric].color} stopOpacity={0}/>
                    </linearGradient>
                  </defs>
                  <CartesianGrid strokeDasharray="3 3" stroke={colors.borderSubtle} vertical={false} />
                  <XAxis dataKey="date" tick={{ fill: colors.textMuted, fontSize: 11 }} axisLine={false} tickLine={false} />
                  <YAxis 
                    tickFormatter={trendConfigs[trendMetric].format} 
                    tick={{ fill: colors.textMuted, fontSize: 11 }} 
                    axisLine={false} 
                    tickLine={false}
                    domain={trendMetric === 'rating' ? [0, 10] : ['auto', 'auto']}
                  />
                  <Tooltip content={<CustomTooltip />} />
                  <Area 
                    type="monotone" 
                    dataKey={trendConfigs[trendMetric].dataKey} 
                    stroke={trendConfigs[trendMetric].color} 
                    strokeWidth={2}
                    fill="url(#colorTrend)" 
                    name={trendConfigs[trendMetric].label}
                    connectNulls
                  />
                </AreaChart>
              </ResponsiveContainer>
            </div>

            {/* Two column section */}
            <div className="two-col-grid" style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '24px', marginBottom: '24px' }}>
              
              {/* Hourly Orders */}
              <div style={{
                background: colors.card,
                borderRadius: '16px',
                border: `1px solid ${colors.border}`,
                padding: 'clamp(20px, 4vw, 28px)',
              }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '24px' }}>
                  <IconBox color="#60A5FA">‚è∞</IconBox>
                  <h2 style={{ fontFamily: "'Space Grotesk', sans-serif", fontSize: '20px', fontWeight: 600 }}>
                    Orders by Hour
                  </h2>
                </div>
                <ResponsiveContainer width="100%" height={220}>
                  <BarChart data={hourlyData}>
                    <CartesianGrid strokeDasharray="3 3" stroke={colors.borderSubtle} vertical={false} />
                    <XAxis dataKey="hour" tick={{ fill: colors.textMuted, fontSize: 10 }} axisLine={false} tickLine={false} />
                    <YAxis tick={{ fill: colors.textMuted, fontSize: 10 }} axisLine={false} tickLine={false} />
                    <Tooltip content={<CustomTooltip />} />
                    <Bar dataKey="orders" fill={colors.info} radius={[4, 4, 0, 0]} name="Orders" />
                  </BarChart>
                </ResponsiveContainer>
              </div>

              {/* Delivery by Hour */}
              <div style={{
                background: colors.card,
                borderRadius: '16px',
                border: `1px solid ${colors.border}`,
                padding: 'clamp(20px, 4vw, 28px)',
              }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '24px' }}>
                  <IconBox color="#34D399">üöö</IconBox>
                  <h2 style={{ fontFamily: "'Space Grotesk', sans-serif", fontSize: '20px', fontWeight: 600 }}>
                    Delivery Time by Hour
                  </h2>
                </div>
                <ResponsiveContainer width="100%" height={220}>
                  <BarChart data={hourlyData}>
                    <CartesianGrid strokeDasharray="3 3" stroke={colors.borderSubtle} vertical={false} />
                    <XAxis dataKey="hour" tick={{ fill: colors.textMuted, fontSize: 10 }} axisLine={false} tickLine={false} />
                    <YAxis tick={{ fill: colors.textMuted, fontSize: 10 }} axisLine={false} tickLine={false} />
                    <Tooltip content={<CustomTooltip />} />
                    <Bar dataKey="avgDelivery" radius={[4, 4, 0, 0]} name="Avg Delivery (min)">
                      {hourlyData.map((entry, index) => (
                        <Cell 
                          key={index} 
                          fill={entry.avgDelivery <= 35 ? colors.success : entry.avgDelivery <= 45 ? colors.warning : colors.error} 
                        />
                      ))}
                    </Bar>
                  </BarChart>
                </ResponsiveContainer>
              </div>
            </div>

            {/* Venue Breakdown */}
            <div style={{
              background: colors.card,
              borderRadius: '16px',
              border: `1px solid ${colors.border}`,
              padding: 'clamp(20px, 4vw, 28px)',
              marginBottom: '24px',
            }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '24px' }}>
                <IconBox color="#22C55E">üìç</IconBox>
                <h2 style={{ fontFamily: "'Space Grotesk', sans-serif", fontSize: '20px', fontWeight: 600 }}>
                  Venue Breakdown
                </h2>
              </div>

              <div className="venue-grid" style={{ display: 'grid', gridTemplateColumns: '2fr 1fr 1fr 1fr 1fr', gap: '8px', marginBottom: '8px' }}>
                <span style={{ color: colors.textMuted, fontSize: '11px', textTransform: 'uppercase' }}>Venue</span>
                <span style={{ color: colors.textMuted, fontSize: '11px', textTransform: 'uppercase', textAlign: 'right' }}>Revenue</span>
                <span style={{ color: colors.textMuted, fontSize: '11px', textTransform: 'uppercase', textAlign: 'right' }}>Orders</span>
                <span className="hide-mobile" style={{ color: colors.textMuted, fontSize: '11px', textTransform: 'uppercase', textAlign: 'right' }}>Avg Basket</span>
                <span style={{ color: colors.textMuted, fontSize: '11px', textTransform: 'uppercase', textAlign: 'right' }}>Rating</span>
              </div>
              
              {venueData.slice(0, 12).map((v, i) => (
                <div key={i} className="venue-grid" style={{
                  display: 'grid',
                  gridTemplateColumns: '2fr 1fr 1fr 1fr 1fr',
                  gap: '8px',
                  padding: '12px 0',
                  borderBottom: i < venueData.length - 1 ? `1px solid ${colors.borderSubtle}` : 'none',
                }}>
                  <span style={{ fontSize: '13px', overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>{v.venue}</span>
                  <span style={{ fontFamily: "'Space Grotesk', sans-serif", fontWeight: 600, fontSize: '13px', textAlign: 'right' }}>
                    {formatK(v.revenue)}
                  </span>
                  <span style={{ color: colors.textSecondary, fontSize: '13px', textAlign: 'right' }}>{v.orders}</span>
                  <span className="hide-mobile" style={{ color: colors.textSecondary, fontSize: '13px', textAlign: 'right' }}>{formatRSD(v.basket)}</span>
                  <span style={{ 
                    fontWeight: 600, 
                    fontSize: '13px', 
                    textAlign: 'right',
                    color: v.rating === null ? colors.textMuted : v.rating >= 9 ? colors.success : v.rating >= 8 ? colors.warning : colors.error,
                  }}>
                    {v.rating !== null ? `${v.rating}/10` : '‚Äî'}
                  </span>
                </div>
              ))}
            </div>

            {/* Top Products */}
            <div style={{
              background: colors.card,
              borderRadius: '16px',
              border: `1px solid ${colors.border}`,
              padding: 'clamp(20px, 4vw, 28px)',
              marginBottom: '24px',
            }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '24px' }}>
                <IconBox color="#F59E0B">üèÜ</IconBox>
                <h2 style={{ fontFamily: "'Space Grotesk', sans-serif", fontSize: '20px', fontWeight: 600 }}>
                  Top Products
                </h2>
              </div>

              {topProducts.map((product, i) => (
                <div key={i} style={{
                  background: i < 3 ? colors.elevated : 'transparent',
                  borderRadius: '12px',
                  padding: '16px',
                  marginBottom: '8px',
                  display: 'grid',
                  gridTemplateColumns: '40px 1fr 80px 100px',
                  gap: '16px',
                  alignItems: 'center',
                  border: i >= 3 ? `1px solid ${colors.borderSubtle}` : 'none',
                }}>
                  <span style={{
                    width: '28px',
                    height: '28px',
                    borderRadius: '50%',
                    background: i < 3 ? colors.purple : colors.elevated,
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    fontSize: '12px',
                    fontWeight: 600,
                  }}>
                    {product.rank}
                  </span>
                  
                  <div style={{ minWidth: 0 }}>
                    <p style={{ fontSize: '13px', fontWeight: 500, marginBottom: '4px', overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>{product.name}</p>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px', flexWrap: 'wrap' }}>
                      <span style={{ color: colors.textMuted, fontSize: '11px' }}>{product.qty} sold</span>
                      <span style={{ color: colors.textMuted, fontSize: '11px' }}>{product.pct}% sales</span>
                      {product.rating && <span style={{ color: product.rating >= 9 ? colors.success : colors.warning, fontSize: '11px', fontWeight: 600 }}>{product.rating}‚≠ê</span>}
                    </div>
                  </div>
                  
                  <div style={{ textAlign: 'right' }}>
                    <p style={{ fontFamily: "'Space Grotesk', sans-serif", fontWeight: 700, fontSize: '16px' }}>
                      {formatK(product.revenue)}
                    </p>
                    <p style={{ color: colors.textMuted, fontSize: '10px' }}>RSD</p>
                  </div>

                  <div style={{ textAlign: 'right' }}>
                    <p style={{ fontFamily: "'Space Grotesk', sans-serif", fontWeight: 700, fontSize: '16px', color: colors.success }}>
                      {product.margin}%
                    </p>
                    <p style={{ color: colors.textMuted, fontSize: '10px' }}>margin</p>
                  </div>
                </div>
              ))}
            </div>

            {/* Category Performance */}
            <div style={{
              background: colors.card,
              borderRadius: '16px',
              border: `1px solid ${colors.border}`,
              padding: 'clamp(20px, 4vw, 28px)',
              marginBottom: '24px',
            }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '24px' }}>
                <IconBox color="#F59E0B">ü•ß</IconBox>
                <h2 style={{ fontFamily: "'Space Grotesk', sans-serif", fontSize: '20px', fontWeight: 600 }}>
                  Category Performance
                </h2>
              </div>

              {categoryData.map((cat, i) => {
                const maxRevenue = categoryData[0]?.revenue || 1;
                const width = (cat.revenue / maxRevenue) * 100;
                const icons = { Burgers: 'üçî', Pancakes: 'ü•û', 'Cooked Meals': 'üç≤', Sides: 'üçü', Bakery: 'ü•ê', Other: 'üì¶' };
                
                return (
                  <div key={i} style={{ marginBottom: '16px' }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '8px' }}>
                      <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                        <span style={{ fontSize: '20px' }}>{icons[cat.name] || 'üì¶'}</span>
                        <span style={{ fontSize: '14px', fontWeight: 500 }}>{cat.name}</span>
                        <span style={{ color: colors.textMuted, fontSize: '12px', background: colors.elevated, padding: '4px 10px', borderRadius: '12px' }}>
                          {cat.mix}% mix
                        </span>
                      </div>
                      <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>
                        <span style={{ fontFamily: "'Space Grotesk', sans-serif", fontWeight: 700 }}>{formatK(cat.revenue)}</span>
                        <span style={{ color: colors.success, fontSize: '13px' }}>{cat.margin}% margin</span>
                      </div>
                    </div>
                    <div style={{ height: '8px', background: colors.elevated, borderRadius: '4px', overflow: 'hidden' }}>
                      <div style={{ 
                        width: `${width}%`, 
                        height: '100%', 
                        background: `linear-gradient(90deg, ${colors.purple}, ${colors.purpleLight})`,
                        borderRadius: '4px',
                      }} />
                    </div>
                  </div>
                );
              })}
            </div>

            {/* Footer */}
            <div style={{ textAlign: 'center', padding: '16px', color: colors.textMuted, fontSize: '12px' }}>
              Interactive Dashboard v1.0 | {metrics.orders} orders | {customerData.total} customers | {metrics.reviewCount} reviews | Data: {orders.length} total orders
            </div>

          </div>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<CollinaDashboard />);
  </script>
</body>
</html>

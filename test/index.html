<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Collina Dashboard</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  
  <!-- Widget Registry -->
  <script>window.WidgetRegistry = {};</script>
  
  <!-- Load Widget Files -->
  <script src="widgets/revenue-widget.js"></script>
  <script src="widgets/orders-widget.js"></script>
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, sans-serif; background: #0D0B14; color: white; }
    .sidebar-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.5);
      z-index: 998; opacity: 0; pointer-events: none; transition: opacity 0.3s;
    }
    .sidebar-overlay.open { opacity: 1; pointer-events: auto; }
    .sidebar {
      position: fixed; top: 0; left: 0; width: 300px; height: 100vh;
      background: #1A1F2E; z-index: 999; transform: translateX(-100%);
      transition: transform 0.3s; padding: 20px; overflow-y: auto;
    }
    .sidebar.open { transform: translateX(0); }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script>
    var useState = React.useState;
    var createElement = React.createElement;
    
    function App() {
      var sidebarState = useState(false);
      var sidebarOpen = sidebarState[0];
      var setSidebarOpen = sidebarState[1];
      
      // Get widget list from registry
      var widgetList = Object.values(window.WidgetRegistry);
      
      // Initialize visibility state for all registered widgets (all on by default)
      var initialVisibility = {};
      widgetList.forEach(function(w) {
        initialVisibility[w.id] = true;
      });
      
      var visibilityState = useState(initialVisibility);
      var widgets = visibilityState[0];
      var setWidgets = visibilityState[1];
      
      function toggleWidget(id) {
        setWidgets(function(prev) {
          var next = {};
          for (var key in prev) next[key] = prev[key];
          next[id] = !prev[id];
          return next;
        });
      }
      
      // Count visible widgets
      var visibleCount = 0;
      for (var key in widgets) {
        if (widgets[key]) visibleCount++;
      }
      
      return createElement('div', { style: { padding: '20px' } }, [
        
        // Sidebar Overlay
        createElement('div', {
          key: 'overlay',
          className: sidebarOpen ? 'sidebar-overlay open' : 'sidebar-overlay',
          onClick: function() { setSidebarOpen(false); }
        }),
        
        // Sidebar
        createElement('div', {
          key: 'sidebar',
          className: sidebarOpen ? 'sidebar open' : 'sidebar'
        }, [
          // Sidebar header
          createElement('div', {
            key: 'header',
            style: { display: 'flex', justifyContent: 'space-between', marginBottom: '20px' }
          }, [
            createElement('h2', { key: 'title', style: { fontSize: '18px' } }, '‚öôÔ∏è Widgets'),
            createElement('button', {
              key: 'close',
              onClick: function() { setSidebarOpen(false); },
              style: { background: 'none', border: 'none', color: 'white', fontSize: '20px', cursor: 'pointer' }
            }, '‚úï'),
          ]),
          
          createElement('p', {
            key: 'desc',
            style: { color: '#888', fontSize: '12px', marginBottom: '16px' }
          }, 'Toggle widgets on/off to customize your dashboard'),
          
          // Widget toggles
          widgetList.map(function(w) {
            var isOn = widgets[w.id];
            return createElement('div', {
              key: w.id,
              onClick: function() { toggleWidget(w.id); },
              style: {
                padding: '12px',
                background: isOn ? 'rgba(139,92,246,0.2)' : '#252232',
                borderRadius: '8px',
                cursor: 'pointer',
                marginBottom: '8px',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'space-between',
              }
            }, [
              createElement('span', { key: 'name' }, w.icon + ' ' + w.name),
              // Toggle switch
              createElement('div', {
                key: 'toggle',
                style: {
                  width: '40px',
                  height: '22px',
                  background: isOn ? '#8B5CF6' : '#444',
                  borderRadius: '11px',
                  position: 'relative',
                  transition: 'background 0.2s',
                }
              }, [
                createElement('div', {
                  key: 'knob',
                  style: {
                    width: '18px',
                    height: '18px',
                    background: 'white',
                    borderRadius: '50%',
                    position: 'absolute',
                    top: '2px',
                    left: isOn ? '20px' : '2px',
                    transition: 'left 0.2s',
                  }
                })
              ])
            ]);
          })
        ]),
        
        // Header
        createElement('div', {
          key: 'main-header',
          style: { display: 'flex', alignItems: 'center', gap: '16px', marginBottom: '24px' }
        }, [
          // Hamburger menu
          createElement('button', {
            key: 'hamburger',
            onClick: function() { setSidebarOpen(true); },
            style: {
              background: '#1A1F2E',
              border: '1px solid rgba(255,255,255,0.1)',
              borderRadius: '10px',
              padding: '10px 12px',
              cursor: 'pointer',
              display: 'flex',
              flexDirection: 'column',
              gap: '4px',
            }
          }, [
            createElement('div', { key: 'l1', style: { width: '20px', height: '2px', background: '#888' } }),
            createElement('div', { key: 'l2', style: { width: '20px', height: '2px', background: '#888' } }),
            createElement('div', { key: 'l3', style: { width: '20px', height: '2px', background: '#888' } }),
          ]),
          createElement('div', { key: 'title-section' }, [
            createElement('h1', {
              key: 'title',
              style: {
                fontSize: '28px',
                background: 'linear-gradient(to right, #A78BFA, #818CF8)',
                WebkitBackgroundClip: 'text',
                WebkitTextFillColor: 'transparent',
              }
            }, 'Collina Dashboard'),
            createElement('p', {
              key: 'subtitle',
              style: { color: '#888', fontSize: '14px' }
            }, visibleCount + ' of ' + widgetList.length + ' widgets visible'),
          ]),
        ]),
        
        // Widgets Container
        createElement('div', {
          key: 'widgets-container',
          style: { display: 'flex', flexDirection: 'column', gap: '20px' }
        }, [
          // Render visible widgets
          widgetList.map(function(w) {
            if (!widgets[w.id]) return null;
            return createElement(w.component, { key: w.id });
          }),
          
          // Empty state
          visibleCount === 0 ? createElement('div', {
            key: 'empty',
            style: {
              background: '#1A1F2E',
              borderRadius: '16px',
              padding: '48px',
              textAlign: 'center',
              border: '1px dashed rgba(255,255,255,0.1)',
            }
          }, [
            createElement('p', { key: 'icon', style: { fontSize: '48px', marginBottom: '16px' } }, 'üôà'),
            createElement('p', { key: 'text', style: { color: '#888' } }, 'No widgets selected'),
            createElement('p', { key: 'hint', style: { color: '#666', fontSize: '14px' } }, 'Click the menu to enable widgets'),
          ]) : null,
        ]),
      ]);
    }
    
    ReactDOM.createRoot(document.getElementById('root')).render(createElement(App));
  </script>
</body>
</html>
